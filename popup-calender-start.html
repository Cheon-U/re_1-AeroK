<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="./css/pretendard.css">
    <link rel="stylesheet" href="./css/popup-calendar.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/rangePlugin.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
    <title>popup-cal</title>

</head>

<body>
    <main>

        <div class="popup-title">출발일 선택</div>
        <!-- 캘린더1 -->
        <div class="calendar">
            <div class="startDate">
            </div>
        </div>
        <!-- 캘린더2 -->
        <div class="calendar">
            <div class="endDate">
            </div>
        </div>

        <script>
            let showDate = document.querySelector(".showDate");
            flatpickr(".startDate", {
                "plugins": [new rangePlugin({ input: ".endDate" })],
                minDate: "today",
                maxDate: "2025-12-31",
                showMonths: 2,
                inline: true,
                locale: "ko", // 한국어 적용
                onChange: function (selectedDates, dateStr, instance) {
                    // 날짜가 2개 선택된 상태에서 다시 같은 날짜를 클릭한 경우 → 초기화
                    if (
                        selectedDates.length === 2 &&
                        previousDates.length === 2 &&
                        selectedDates[0].getTime() === previousDates[0].getTime() &&
                        selectedDates[1].getTime() === previousDates[1].getTime()
                    ) {
                        instance.clear();
                        showDate.innerHTML = "선택된 날짜 없음";
                        previousDates = [];
                        return;
                    }

                    // 날짜 출력
                    if (selectedDates.length === 1) {
                        const start = instance.formatDate(selectedDates[0], "Y-m-d");
                        showDate.innerHTML = `출발일: ${start}`;
                    } else if (selectedDates.length === 2) {
                        const start = instance.formatDate(selectedDates[0], "Y-m-d");
                        const end = instance.formatDate(selectedDates[1], "Y-m-d");
                        showDate.innerHTML = `출발일: ${start}<br>도착일: ${end}`;
                    } else {
                        showDate.innerHTML = "선택된 날짜 없음";
                    }

                    // 현재 선택 상태 저장
                    previousDates = [...selectedDates];
                },
                onDayCreate: function (dObj, dStr, fp, dayElem) {
                    // 일(dayElem.dateObj)의 요일 확인 (0: 일요일, 6: 토요일)
                    const date = dayElem.dateObj;
                    if (date.getDay() === 0) { // 일요일
                        dayElem.classList.add("sunday");
                    }
                }
            });
        </script>
    </main>
</body>

</html>